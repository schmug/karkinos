---
name: worker
description: Spawn a Claude worker in an isolated git worktree for parallel development. Use when you need to work on a task in isolation without affecting current work.
allowed-tools: Bash, Read, Write, Edit, Glob, Grep
---

# Worker Skill

Spawn a Claude worker in an isolated git worktree.

## Usage

```
/worker <branch-name> <task description>
```

## Examples

```
/worker feat/add-logging Add structured logging to the supervisor module
/worker fix/auth-bug Fix the authentication bypass in the API
/worker refactor/cleanup Refactor the instance manager for clarity
```

## Instructions

When the user invokes `/worker`, follow these steps:

### 1. Parse Arguments

Extract the branch name (first argument) and task description (remaining text).

### 2. Pre-Spawn Conflict Check

**CRITICAL**: Before creating the worktree, verify no file conflicts exist:

```bash
# Analyze which files the task will likely modify
# Then check existing workers for conflicts
for worktree in $(git worktree list --porcelain | grep "^worktree" | cut -d' ' -f2 | grep -v "$(pwd)$"); do
  echo "=== Checking: $worktree ==="
  git -C "$worktree" diff --name-only staging 2>/dev/null
done
```

If any existing worker is modifying files that this task will touch, **DO NOT SPAWN**. Either:
- Wait for the conflicting worker to complete
- Queue this task for later
- Inform the user of the conflict

### 3. Ensure Staging Branch Exists

```bash
# Ensure staging branch exists and is up to date
git fetch origin
git checkout staging 2>/dev/null || git checkout -b staging origin/main
git pull origin staging 2>/dev/null || true
```

### 4. Create Worktree

```bash
# Get project name for worktree prefix
PROJECT=$(basename $(git rev-parse --show-toplevel))
WORKTREE_PATH="../${PROJECT}-$(echo $BRANCH | tr '/' '-')"

# Create the worktree with a new branch FROM STAGING
git worktree add "$WORKTREE_PATH" -b "$BRANCH" staging
```

### 5. Spawn Worker Claude

Run a Claude instance in the worktree with full autonomy:

```bash
cd "$WORKTREE_PATH" && claude --print --dangerously-skip-permissions "$TASK_DESCRIPTION"
```

### 6. Push and Create PR (targeting staging)

After the worker completes successfully and has made commits:

```bash
# Push the branch to origin
git push -u origin "$BRANCH"

# Create PR targeting STAGING (not main)
gh pr create --base staging --title "<commit message or task summary>" --body "$(cat <<'EOF'
## Summary
<brief description of changes>

## Changes
<list of key changes made>

---
ðŸ¤– Generated by Claude worker
EOF
)"

# Enable auto-merge (will merge automatically when CI passes)
gh pr merge --auto --squash
```

### 7. Report Results

After the worker completes:
1. Show the worker's output
2. Show any commits made: `git log $BRANCH --oneline -5`
3. Show the PR URL if created
4. Offer next steps:
   - Review the PR
   - Continue working (spawn another worker command)
   - Clean up the worktree

## Important Notes

- Workers have full autonomy (`--dangerously-skip-permissions`)
- **All branches are created from `staging`**, not main
- **All PRs target `staging`**, not main
- **ALWAYS check for file conflicts** before spawning a new worker
- Each worker gets its own branch - no conflicts with main work
- Workers push their branch and create PRs when done
- Use `git worktree list` to see active workers
- Use `git worktree remove <path>` to clean up

**Staging Workflow:** Worker PRs merge to staging. When CI is green on staging, create a PR from staging â†’ main.

**Tip:** Run `karkinos watch` in another terminal to monitor worker progress in real-time, or use `karkinos watch --spawn` to open it automatically.
